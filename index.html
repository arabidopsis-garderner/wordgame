<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8"> <!-- è®¾ç½®å­—ç¬¦ç¼–ç ä¸º UTF-8ï¼Œæ”¯æŒä¸­æ–‡ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- ç¡®ä¿é¡µé¢æŒ‰è®¾å¤‡å®½åº¦ç¼©æ”¾ï¼Œé€‚é…ç§»åŠ¨è®¾å¤‡ -->
    <title>æ±‰å­—æ‹¼è¯»æŒ‘æˆ˜èµ›å®Œæ•´ç‰ˆ</title>
    <style>
        :root {
            --primary-color: #FFB6C1; /* å®šä¹‰ä¸»è‰²è°ƒï¼Œç”¨äºèƒŒæ™¯æ¸å˜ */
            --secondary-color: #87CEEB; /* å®šä¹‰å‰¯è‰²è°ƒï¼Œç”¨äºèƒŒæ™¯æ¸å˜ */
        }

        body {
            font-family: 'Comic Sans MS', 'å¹¼åœ†', 'YouYuan', 'PingFang SC', sans-serif; /* è®¾ç½®å­—ä½“ï¼Œæ”¯æŒ iOS å’Œ Android çš„å›é€€ */
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); /* èƒŒæ™¯æ¸å˜ï¼Œå¢å¼ºè§†è§‰æ•ˆæœ */
            min-height: 100vh; /* ç¡®ä¿é¡µé¢è‡³å°‘å æ»¡è§†å£é«˜åº¦ */
            margin: 0; /* ç§»é™¤é»˜è®¤å¤–è¾¹è· */
            padding: 20px; /* æ·»åŠ å†…è¾¹è·ï¼Œä¼˜åŒ–ç§»åŠ¨ç«¯æ˜¾ç¤º */
            display: flex; /* ä½¿ç”¨ Flex å¸ƒå±€å±…ä¸­å†…å®¹ */
            flex-direction: column; /* å‚ç›´æ’åˆ—å…ƒç´  */
            align-items: center; /* æ°´å¹³å±…ä¸­ */
        }
        
        .game-title {
            color: #ff4757; /* è®¾ç½®æ ‡é¢˜é¢œè‰²ä¸ºçº¢è‰² */
            font-size: 2.5em; /* æ ‡é¢˜å­—ä½“å¤§å° */
            text-shadow: 2px 2px #fff; /* æ·»åŠ ç™½è‰²é˜´å½±ï¼Œæå‡å¯è¯»æ€§ */
            margin: 20px 0; /* ä¸Šä¸‹å¤–è¾¹è· */
        }

        .game-container {
            background: rgba(255, 255, 255, 0.9); /* åŠé€æ˜ç™½è‰²èƒŒæ™¯ */
            border-radius: 20px; /* åœ†è§’è®¾è®¡ */
            padding: 20px; /* å†…è¾¹è· */
            box-shadow: 0 8px 16px rgba(0,0,0,0.1); /* æ·»åŠ é˜´å½±ï¼Œå¢å¼ºç«‹ä½“æ„Ÿ */
            max-width: 900px; /* æœ€å¤§å®½åº¦é™åˆ¶ */
            width: 100%; /* å æ»¡å¯ç”¨å®½åº¦ */
        }

        .game-grid {
            display: grid; /* ä½¿ç”¨ç½‘æ ¼å¸ƒå±€ */
            grid-template-columns: repeat(6, 1fr); /* é»˜è®¤ 6 åˆ—ç­‰å®½å¸ƒå±€ */
            gap: 15px; /* ç½‘æ ¼é—´è· */
            justify-items: center; /* ç½‘æ ¼é¡¹æ°´å¹³å±…ä¸­ */
            margin: 20px 0; /* ä¸Šä¸‹å¤–è¾¹è· */
        }

        .pinyin {
            color: #4CAF50; /* æ‹¼éŸ³é¢œè‰²ä¸ºç»¿è‰² */
            font-size: 24px; /* é»˜è®¤å­—ä½“å¤§å° */
            text-align: center; /* å±…ä¸­å¯¹é½ */
            width: 100px; /* å›ºå®šå®½åº¦ */
            margin: 0 5px; /* å·¦å³å¤–è¾¹è· */
        }

        .drop-zone {
            width: 70px; /* é»˜è®¤å®½åº¦ */
            height: 70px; /* é»˜è®¤é«˜åº¦ */
            border: 2px solid #666; /* ç°è‰²è¾¹æ¡† */
            border-radius: 10px; /* åœ†è§’ */
            background: white; /* ç™½è‰²èƒŒæ™¯ */
            margin: 0 5px; /* å·¦å³å¤–è¾¹è· */
            display: flex; /* Flex å¸ƒå±€å±…ä¸­å†…å®¹ */
            justify-content: center; /* æ°´å¹³å±…ä¸­ */
            align-items: center; /* å‚ç›´å±…ä¸­ */
            font-size: 42px; /* é»˜è®¤å­—ä½“å¤§å° */
            font-family: 'åæ–‡å½©äº‘', 'PingFang SC', sans-serif; /* å­—ä½“æ”¯æŒè·¨å¹³å° */
            touch-action: none; /* ç¦ç”¨è§¦æ‘¸é»˜è®¤è¡Œä¸ºï¼Œé¿å…å¹²æ‰°æ‹–åŠ¨ */
        }

        .character {
            width: 70px; /* é»˜è®¤å®½åº¦ */
            height: 70px; /* é»˜è®¤é«˜åº¦ */
            background: white; /* ç™½è‰²èƒŒæ™¯ */
            border-radius: 10px; /* åœ†è§’ */
            box-shadow: 0 4px 8px rgba(0,0,0,0.1); /* é˜´å½±æ•ˆæœ */
            cursor: grab; /* é¼ æ ‡æ‰‹åŠ¿æç¤ºå¯æ‹–åŠ¨ */
            user-select: none; /* ç¦ç”¨æ–‡æœ¬é€‰æ‹© */
            display: flex; /* Flex å¸ƒå±€å±…ä¸­å†…å®¹ */
            justify-content: center; /* æ°´å¹³å±…ä¸­ */
            align-items: center; /* å‚ç›´å±…ä¸­ */
            font-size: 42px; /* é»˜è®¤å­—ä½“å¤§å° */
            font-family: 'åæ–‡å½©äº‘', 'PingFang SC', sans-serif; /* å­—ä½“æ”¯æŒè·¨å¹³å° */
            transition: all 0.3s; /* å¹³æ»‘è¿‡æ¸¡æ•ˆæœ */
            padding: 10px; /* å¢å¤§è§¦æ‘¸åŒºåŸŸ */
            will-change: transform; /* ä¼˜åŒ–åŠ¨ç”»æ€§èƒ½ï¼Œæç¤ºæµè§ˆå™¨æå‰å‡†å¤‡å˜æ¢ */
        }

        .character:hover, .character.dragging {
            transform: scale(1.05); /* æ‹–åŠ¨æˆ–æ‚¬åœæ—¶æ”¾å¤§ï¼Œæä¾›è§†è§‰åé¦ˆ */
            box-shadow: 0 8px 16px rgba(0,0,0,0.2); /* å¢å¼ºé˜´å½± */
            background: rgba(0,0,0,0.05); /* è½»å¾®é«˜äº®æ•ˆæœ */
        }

        .character[hidden] {
            display: none !important; /* éšè—å·²åŒ¹é…çš„å­—ç¬¦ */
        }

        .correct { 
            background: #90EE90 !important; /* æ­£ç¡®æ—¶ç»¿è‰²èƒŒæ™¯ */
            transform: scale(1.05); /* è½»å¾®æ”¾å¤§ */
        }

        .wrong { 
            background: #FFB6C1 !important; /* é”™è¯¯æ—¶ç²‰è‰²èƒŒæ™¯ */
            animation: shake 0.5s; /* æŠ–åŠ¨åŠ¨ç”» */
        }

        #restart {
            padding: 12px 24px; /* å†…è¾¹è· */
            font-size: 20px; /* å­—ä½“å¤§å° */
            border-radius: 30px; /* åœ†è§’ */
            background: #FFD700; /* é‡‘è‰²èƒŒæ™¯ */
            border: none; /* æ— è¾¹æ¡† */
            cursor: pointer; /* é¼ æ ‡æ‰‹åŠ¿ */
            display: none; /* é»˜è®¤éšè— */
            font-family: 'å¹¼åœ†', 'YouYuan', 'PingFang SC', sans-serif; /* å­—ä½“æ”¯æŒè·¨å¹³å° */
        }

        #speech-prompt {
            color: #fff; /* ç™½è‰²æ–‡å­— */
            font-size: 18px; /* å­—ä½“å¤§å° */
            margin: 10px 0; /* ä¸Šä¸‹å¤–è¾¹è· */
            text-align: center; /* å±…ä¸­å¯¹é½ */
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); } /* æŠ–åŠ¨åŠ¨ç”»èµ·ç‚¹å’Œç»ˆç‚¹ */
            25% { transform: translateX(-10px); } /* å·¦ç§» */
            75% { transform: translateX(10px); } /* å³ç§» */
        }

        /* å°å±å¹•é€‚é…ï¼ˆæ‰‹æœºï¼‰ */
        @media (max-width: 600px) {
            .game-grid { grid-template-columns: repeat(3, 1fr); gap: 10px; } /* 3 åˆ—å¸ƒå±€ */
            .pinyin { font-size: 20px; } /* æ‹¼éŸ³å­—ä½“ç¼©å° */
            .drop-zone, .character { width: 60px; height: 60px; font-size: 36px; } /* å…ƒç´ ç¼©å° */
        }

        /* ä¸­ç­‰å±å¹•é€‚é…ï¼ˆå¹³æ¿ï¼Œå¦‚ iPadï¼‰ */
        @media (min-width: 601px) and (max-width: 1024px) {
            .game-grid { grid-template-columns: repeat(8, 1fr); gap: 20px; } /* 8 åˆ—å¸ƒå±€ */
            .drop-zone, .character { width: 80px; height: 80px; } /* å…ƒç´ æ”¾å¤§ */
        }

        /* æ¨ªå±æ¨¡å¼é€‚é… */
        @media (orientation: landscape) {
            .game-grid { grid-template-columns: repeat(10, 1fr); gap: 15px; } /* æ¨ªå±ä¸‹ 10 åˆ— */
            .drop-zone, .character { width: 70px; height: 70px; } /* è°ƒæ•´å…ƒç´ å¤§å° */
        }
    </style>
</head>
<body>
    <h1 class="game-title">ğŸ¼ æ™ºèƒ½æ±‰å­—æ‹¼è¯»æŒ‘æˆ˜ ğŸª</h1> <!-- æ¸¸æˆæ ‡é¢˜ -->
    <div id="speech-prompt">ç‚¹å‡»ä»»æ„æ±‰å­—ä»¥å¯ç”¨è¯­éŸ³åŠŸèƒ½</div> <!-- è¯­éŸ³åŠŸèƒ½æç¤º -->
    <div class="game-container">
        <div class="game-grid" id="pinyin-row"></div> <!-- æ‹¼éŸ³è¡Œ -->
        <div class="game-grid" id="dropzone-row"></div> <!-- æ”¾ç½®åŒºè¡Œ -->
        <div class="game-grid" id="character-row"></div> <!-- æ±‰å­—è¡Œ -->
    </div>
    <button id="restart">å†æ¥ä¸€æ¬¡ï¼</button> <!-- é‡å¯æŒ‰é’® -->

    <script>
        // æ±‰å­—å’Œæ‹¼éŸ³æ˜ å°„è¡¨
        const pronunciationMap = {
            "ä¸€":"yÄ«", "äºŒ":"Ã¨r", "ä¸‰":"sÄn", "å››":"sÃ¬", "äº”":"wÇ”",
            "å…­":"liÃ¹", "ä¸ƒ":"qÄ«", "å…«":"bÄ", "ä¹":"jiÇ”", "å":"shÃ­",
            "ä¸¤":"liÇng", "åª":"zhÄ«", "å¤´":"tÃ³u", "åˆ":"yÃ²u", "äº†":"le",
            "ä¸":"bÃ¹", "å¤§":"dÃ ", "å°":"xiÇo", "ä¸Š":"shÃ ng", "ä¸‹":"xiÃ ",
            "å¤š":"duÅ", "å°‘":"shÇo", "ç™½":"bÃ¡i", "å¤©":"tiÄn", "äº‘":"yÃºn",
            "å±±":"shÄn", "æœˆ":"yuÃ¨", "äº®":"liÃ ng", "æ˜Ÿ":"xÄ«ng", "é©¬":"mÇ",
            "ç‰›":"niÃº", "ç¾Š":"yÃ¡ng", "å…”":"tÃ¹", "è™«":"chÃ³ng", "é¸Ÿ":"niÇo",
            "èŠ±":"huÄ", "è‰":"cÇo", "æ ‘":"shÃ¹", "çœ‹":"kÃ n", "èµ°":"zÇ’u",
            "ç¬‘":"xiÃ o", "æ¥":"lÃ¡i", "é£":"fÄ“i", "çˆ±":"Ã i", "æ˜¯":"shÃ¬",
            "è·‘":"pÇo", "è·³":"tiÃ o", "é«˜":"gÄo", "å¤ª":"tÃ i", "é˜³":"yÃ¡ng",
            "åœ°":"dÃ¬", "åƒ":"chÄ«", "å…´":"xÃ¬ng", "å¿«":"kuÃ i", "å¥½":"hÇo",
            "çš„":"de", "çˆ¸":"bÃ ", "å¦ˆ":"mÄ", "æˆ‘":"wÇ’", "äºº":"rÃ©n",
            "å„¿":"Ã©r", "å­":"zÇ", "å£":"kÇ’u", "å‡ ":"jÇ", "ä¸ª":"gÃ¨",
            "ä¸­":"zhÅng", "ç‰™":"yÃ¡", "é—¨":"mÃ©n", "æ‰‹":"shÇ’u", "å¿ƒ":"xÄ«n",
            "ä»€":"shÃ©n", "ä¹ˆ":"me", "å¼€":"kÄi", "å¯":"kÄ›", "å›":"huÃ­",
            "å‡º":"chÅ«", "å»":"qÃ¹", "é‡Œ":"lÇ", "åºŠ":"chuÃ¡ng", "è½¦":"chÄ“",
            "å®¶":"jiÄ", "çˆ·":"yÃ©", "å¥¶":"nÇi", "ä½ ":"nÇ", "æ°´":"shuÇ",
            "é¥­":"fÃ n", "æœ‰":"yÇ’u", "æ‰¾":"zhÇo", "å":"zuÃ²", "å¬":"tÄ«ng",
            "ç©":"wÃ¡n", "å“­":"kÅ«", "èµ·":"qÇ", "å–":"hÄ“", "åˆ°":"dÃ o",
            "æ²³":"hÃ©", "æµ·":"hÇi", "é£":"fÄ“ng", "é›¨":"yÇ”", "é›ª":"xuÄ›",
            "æ˜¥":"chÅ«n", "å¤":"xiÃ ", "ç§‹":"qiÅ«", "å†¬":"dÅng", "é±¼":"yÃº",
            "ç‹¼":"lÃ¡ng", "çŒ«":"mÄo", "ç‹—":"gÇ’u", "è¶":"diÃ©", "èœ‚":"fÄ“ng",
            "è°¢":"xiÃ¨", "ç¡":"shuÃ¬", "çº¢":"hÃ³ng", "è“":"lÃ¡n", "ç»¿":"lÇœ",
            "ç¾":"mÄ›i", "ä¸½":"lÃ¬", "æœ¨":"mÃ¹", "ç‹":"wÃ¡ng", "æ—¥":"rÃ¬",
            "ç™¾":"bÇi", "å…¬":"gÅng", "ä¸»":"zhÇ”", "ç”Ÿ":"shÄ“ng", "é•¿":"zhÇng",
            "è§":"jiÃ n", "å¥³":"nÇš", "åœ¨":"zÃ i", "æ—©":"zÇo", "å¶":"yÃ¨",
            "æ£®":"sÄ“n", "æ—":"lÃ­n", "ä¹¦":"shÅ«", "ä¹ ":"xÃ­", "å¯¹":"duÃ¬",
            "æ²¡":"mÃ©i", "è€":"lÇo", "å¸ˆ":"shÄ«", "ä»–":"tÄ", "ä»¬":"men",
            "å‰":"qiÃ¡n", "å":"hÃ²u", "å“¥":"gÄ“", "å§":"jiÄ›", "å¼Ÿ":"dÃ¬",
            "å¦¹":"mÃ¨i", "å›½":"guÃ³", "è¡£":"yÄ«", "æœ":"fÃº", "å¹¼":"yÃ²u",
            "å›­":"yuÃ¡n", "æ ¡":"xiÃ o", "çˆ¬":"pÃ¡", "è—":"cÃ¡ng", "è¯´":"shuÅ",
            "è§‰":"juÃ©", "æ‰“":"dÇ", "å†™":"xiÄ›", "åš":"zuÃ²", "ç©¿":"chuÄn",
            "è¦":"yÃ o", "æƒ³":"xiÇng", "é»„":"huÃ¡ng", "é»‘":"hÄ“i", "å¾ˆ":"hÄ›n",
            "å†":"zÃ i", "æŠŠ":"bÇ", "å’Œ":"hÃ©", "å•Š":"Ä", "å§":"ba",
            "å—":"mÄ", "å¾—":"de", "ç€":"zhe", "åƒ":"qiÄn", "ä¸‡":"wÃ n",
            "ç”»":"huÃ ", "å­¦":"xuÃ©", "ä¹":"lÃ¨", "åœŸ":"tÇ”", "ç«":"huÇ’",
            "å…‰":"guÄng", "åŠ›":"lÃ¬", "æ°”":"qÃ¬", "åˆ":"wÇ”", "å‘":"fÄ",
            "ç”µ":"diÃ n", "å®":"bÇo", "è´":"bÃ¨i", "è‡ª":"zÃ¬", "å·±":"jÇ",
            "èº«":"shÄ“n", "ä»Š":"jÄ«n", "å¹´":"niÃ¡n", "å²":"suÃ¬", "ç±³":"mÇ",
            "é¢":"miÃ n", "åŒ…":"bÄo", "ç“œ":"guÄ", "æœ":"guÇ’", "ç‚¹":"diÇn",
            "å­—":"zÃ¬", "è¯":"huÃ ", "æœº":"jÄ«", "èˆ¹":"chuÃ¡n", "èœ":"cÃ i",
            "å­©":"hÃ¡i", "ä¸º":"wÃ¨i", "æ¯”":"bÇ", "ä¼š":"huÃ¬", "ç«™":"zhÃ n",
            "è¡Œ":"xÃ­ng", "å«":"jiÃ o", "è¿‡":"guÃ²", "å…³":"guÄn", "å–œ":"xÇ",
            "æ¬¢":"huÄn", "æ€•":"pÃ ", "ç»™":"gÄ›i", "è·Ÿ":"gÄ“n", "è¿›":"jÃ¬n",
            "å¹²":"gÃ n", "å":"huÃ i", "é’":"qÄ«ng", "æ˜":"mÃ­ng", "æ™š":"wÇn",
            "çœŸ":"zhÄ“n", "é¥±":"bÇo", "é”™":"cuÃ²", "ä¸œ":"dÅng", "è¥¿":"xÄ«",
            "å¤–":"wÃ i", "æ¯":"mÄ›i", "è¿™":"zhÃ¨", "å¥¹":"tÄ", "ä¹Ÿ":"yÄ›",
            "è¿˜":"hÃ¡i", "ä»¥":"yÇ", "å‘¢":"ne", "å·¥":"gÅng", "æ–¹":"fÄng",
            "æœ¬":"bÄ›n", "æ–‡":"wÃ©n", "çŸ³":"shÃ­", "é‡‘":"jÄ«n", "æœ‹":"pÃ©ng",
            "å‹":"yÇ’u", "å”":"shÅ«", "å¨ƒ":"wÃ¡", "å©†":"pÃ³", "åŒ»":"yÄ«",
            "è€³":"Ä›r", "çœ¼":"yÇn", "æ™´":"qÃ­ng", "è›™":"wÄ", "é¸¡":"jÄ«",
            "é¸­":"yÄ", "è‹¹":"pÃ­ng", "æ¡ƒ":"tÃ¡o", "çƒ":"qiÃº", "ç¬”":"bÇ",
            "ç¯":"dÄ“ng", "è¯­":"yÇ”", "è¯¾":"kÃ¨", "æ­Œ":"gÄ“", "å£°":"shÄ“ng",
            "éŸ³":"yÄ«n", "è¾¹":"biÄn", "æ—¶":"shÃ­", "ä½“":"tÇ", "æ ·":"yÃ ng",
            "åˆ†":"fÄ“n", "é—®":"wÃ¨n", "å˜":"biÃ n", "æˆ":"chÃ©ng", "ç”¨":"yÃ²ng",
            "åŠ ":"jiÄ", "ä¹°":"mÇi", "å½“":"dÄng", "åŠ¨":"dÃ²ng", "ä½œ":"zuÃ²",
            "ä½":"zhÃ¹", "æ”¾":"fÃ ng", "è¯»":"dÃº", "è½¬":"zhuÇn", "å”±":"chÃ ng",
            "åœ":"tÃ­ng", "æ¸¸":"yÃ³u", "æ•°":"shÇ”", "åƒ":"xiÃ ng", "å":"fÇn",
            "æ­£":"zhÃ¨ng", "åŒ":"tÃ³ng", "ç©º":"kÅng", "æ–°":"xÄ«n", "ç‰‡":"piÃ n",
            "åŠ":"bÃ n", "æœµ":"duÇ’", "æ¡":"tiÃ¡o", "åŒ—":"bÄ›i", "å—":"nÃ¡n",
            "é‚£":"nÃ ", "è°":"shÃ©i", "æ‰":"cÃ¡i", "æ›´":"gÃ¨ng", "éƒ½":"dÅu",
            "ä»":"cÃ³ng", "å‘":"xiÃ ng", "å°±":"jiÃ¹"
        };

        class Game {
            constructor() {
                this.weights = JSON.parse(localStorage.getItem('characterWeights')) || {}; // ä» localStorage è·å–æƒé‡ï¼Œæˆ–åˆå§‹åŒ–ä¸ºç©ºå¯¹è±¡
                this.initWeights(); // åˆå§‹åŒ–æƒé‡
                this.synth = window.speechSynthesis; // è·å–è¯­éŸ³åˆæˆ API
                this.utterance = new SpeechSynthesisUtterance(); // åˆ›å»ºè¯­éŸ³å®ä¾‹
                this.utterance.lang = 'zh-CN'; // è®¾ç½®è¯­è¨€ä¸ºä¸­æ–‡
                this.utterance.rate = 0.8; // è®¾ç½®è¯­é€Ÿä¸ºç¨æ…¢
                this.initGame(); // åˆå§‹åŒ–æ¸¸æˆ
            }

            initWeights() {
                // ä¸ºæ¯ä¸ªæ±‰å­—åˆå§‹åŒ–æƒé‡ï¼Œé»˜è®¤å€¼ä¸º 1
                for (const char in pronunciationMap) {
                    if (!this.weights[char]) this.weights[char] = 1;
                }
            }

            getRandomCharacters() {
                // æ ¹æ®æƒé‡éšæœºé€‰æ‹© 6 ä¸ªä¸é‡å¤çš„æ±‰å­—
                const chars = Object.keys(pronunciationMap);
                const weightedChars = chars.map(char => ({
                    char,
                    weight: this.weights[char]
                }));
                
                const totalWeight = weightedChars.reduce((sum, c) => sum + c.weight, 0); // è®¡ç®—æ€»æƒé‡
                const selected = [];
                
                while (selected.length < 6) {
                    const rand = Math.random() * totalWeight; // ç”Ÿæˆéšæœºæ•°
                    let current = 0;
                    for (const {char, weight} of weightedChars) {
                        current += weight;
                        if (rand <= current && !selected.includes(char)) {
                            selected.push(char); // é€‰æ‹©ä¸é‡å¤çš„å­—ç¬¦
                            break;
                        }
                    }
                }
                return selected;
            }

            initGame() {
                // åˆå§‹åŒ–æ¸¸æˆï¼Œç”Ÿæˆæ‹¼éŸ³å’Œæ±‰å­—å¯¹
                const characters = this.getRandomCharacters();
                const pinyinPairs = characters.map(c => [pronunciationMap[c], c]);
                
                this.renderGame(pinyinPairs); // æ¸²æŸ“æ¸¸æˆç•Œé¢
                this.setupDragDrop(); // è®¾ç½®æ‹–æ”¾åŠŸèƒ½
                this.setupSpeech(); // è®¾ç½®è¯­éŸ³åŠŸèƒ½
            }

            renderGame(pairs) {
                // æ¸²æŸ“æ‹¼éŸ³ã€æ”¾ç½®åŒºå’Œæ±‰å­—è¡Œ
                const pinyinRow = document.getElementById('pinyin-row');
                const dropRow = document.getElementById('dropzone-row');
                const charRow = document.getElementById('character-row');
                
                pinyinRow.innerHTML = dropRow.innerHTML = charRow.innerHTML = ''; // æ¸…ç©ºå†…å®¹

                pairs.forEach(([pinyin]) => {
                    pinyinRow.innerHTML += `<div class="pinyin">${pinyin}</div>`; // æ·»åŠ æ‹¼éŸ³
                    const dropZone = document.createElement('div');
                    dropZone.className = 'drop-zone';
                    dropZone.dataset.pinyin = pinyin; // å­˜å‚¨æ‹¼éŸ³æ•°æ®
                    dropRow.appendChild(dropZone); // æ·»åŠ æ”¾ç½®åŒº
                });

                pairs
                    .sort(() => Math.random() - 0.5) // éšæœºæ’åºæ±‰å­—
                    .forEach(([_, char]) => {
                        const charDiv = document.createElement('div');
                        charDiv.className = 'character';
                        charDiv.draggable = true; // å¯ç”¨é¼ æ ‡æ‹–æ”¾
                        charDiv.dataset.char = char; // å­˜å‚¨æ±‰å­—æ•°æ®
                        charDiv.textContent = char; // è®¾ç½®æ˜¾ç¤ºæ–‡æœ¬
                        charRow.appendChild(charDiv); // æ·»åŠ æ±‰å­—
                    });
            }

            setupDragDrop() {
                // è®¾ç½®æ‹–æ”¾äº¤äº’ï¼Œæ”¯æŒé¼ æ ‡å’Œè§¦æ‘¸
                const chars = document.querySelectorAll('.character');
                const dropZones = document.querySelectorAll('.drop-zone');

                chars.forEach(char => {
                    // é¼ æ ‡æ‹–æ”¾
                    char.addEventListener('dragstart', e => {
                        e.dataTransfer.setData('text/plain', char.dataset.char); // è®¾ç½®æ‹–åŠ¨æ•°æ®
                        char.classList.add('dragging'); // æ·»åŠ æ‹–åŠ¨æ ·å¼
                    });

                    char.addEventListener('dragend', () => {
                        char.classList.remove('dragging'); // ç§»é™¤æ‹–åŠ¨æ ·å¼
                    });

                    // è§¦æ‘¸æ”¯æŒ
                    char.addEventListener('touchstart', e => {
                        e.preventDefault(); // é˜²æ­¢é»˜è®¤è§¦æ‘¸è¡Œä¸º
                        char.dataset.dragging = true; // æ ‡è®°ä¸ºæ‹–åŠ¨çŠ¶æ€
                        char.classList.add('dragging'); // æ·»åŠ æ‹–åŠ¨æ ·å¼
                        const touch = e.touches[0];
                        char.dataset.offsetX = touch.clientX - char.offsetLeft; // è®¡ç®—è§¦æ‘¸åç§»
                        char.dataset.offsetY = touch.clientY - char.offsetTop;
                    });

                    char.addEventListener('touchmove', e => {
                        if (char.dataset.dragging) {
                            const touch = e.touches[0];
                            // ä½¿ç”¨ requestAnimationFrame å¹³æ»‘æ›´æ–°ä½ç½®
                            requestAnimationFrame(() => {
                                char.style.position = 'absolute';
                                char.style.left = `${touch.clientX - char.dataset.offsetX}px`;
                                char.style.top = `${touch.clientY - char.dataset.offsetY}px`;
                            });
                        }
                    });

                    char.addEventListener('touchend', e => {
                        if (char.dataset.dragging) {
                            char.dataset.dragging = false; // å–æ¶ˆæ‹–åŠ¨çŠ¶æ€
                            char.classList.remove('dragging'); // ç§»é™¤æ‹–åŠ¨æ ·å¼
                            const touch = e.changedTouches[0];
                            const dropZone = document.elementFromPoint(touch.clientX, touch.clientY); // æ£€æµ‹ç›®æ ‡åŒºåŸŸ
                            char.style.position = ''; // é‡ç½®ä½ç½®æ ·å¼
                            char.style.left = '';
                            char.style.top = '';
                            if (dropZone && dropZone.classList.contains('drop-zone')) {
                                this.handleDrop(char.dataset.char, dropZone); // å¤„ç†æ”¾ç½®é€»è¾‘
                            }
                        }
                    });
                });

                dropZones.forEach(zone => {
                    zone.addEventListener('dragover', e => e.preventDefault()); // å…è®¸æ‹–æ”¾
                    zone.addEventListener('drop', e => {
                        e.preventDefault();
                        const char = e.dataTransfer.getData('text/plain'); // è·å–æ‹–åŠ¨æ•°æ®
                        this.handleDrop(char, zone); // å¤„ç†æ”¾ç½®é€»è¾‘
                    });
                });
            }

            handleDrop(char, zone) {
                // å¤„ç†æ‹–æ”¾ç»“æœ
                const correctPinyin = pronunciationMap[char];
                if (zone.dataset.pinyin === correctPinyin) {
                    zone.innerHTML = `<div style="font-size:inherit">${char}</div>`; // æ˜¾ç¤ºåŒ¹é…æ±‰å­—
                    document.querySelectorAll(`.character[data-char="${char}"]`)
                        .forEach(c => c.hidden = true); // éšè—åŸå§‹æ±‰å­—
                    zone.classList.add('correct'); // æ·»åŠ æ­£ç¡®æ ·å¼
                    this.updateWeights(char, true); // æ›´æ–°æƒé‡
                } else {
                    zone.classList.add('wrong'); // æ·»åŠ é”™è¯¯æ ·å¼
                    setTimeout(() => zone.classList.remove('wrong'), 500); // 500ms åç§»é™¤
                    this.updateWeights(char, false); // æ›´æ–°æƒé‡
                }
                this.checkCompletion(); // æ£€æŸ¥æ¸¸æˆæ˜¯å¦å®Œæˆ
            }

            updateWeights(char, isCorrect) {
                // æ›´æ–°æ±‰å­—æƒé‡ï¼Œæ­£ç¡®å‡å°‘æƒé‡ï¼Œé”™è¯¯å¢åŠ æƒé‡
                this.weights[char] = Math.min(Math.max(
                    isCorrect ? this.weights[char] * 0.8 : this.weights[char] * 1.2,
                    0.05 // æœ€å°æƒé‡
                ), 0.9); // æœ€å¤§æƒé‡
                localStorage.setItem('characterWeights', JSON.stringify(this.weights)); // ä¿å­˜åˆ° localStorage
            }

            setupSpeech() {
                // è®¾ç½®è¯­éŸ³åŠŸèƒ½ï¼ŒåŒ…å«é”™è¯¯å¤„ç†
                const prompt = document.getElementById('speech-prompt');
                if (!this.synth) {
                    prompt.textContent = 'å½“å‰è®¾å¤‡ä¸æ”¯æŒè¯­éŸ³åŠŸèƒ½'; // å¤„ç†ä¸æ”¯æŒçš„æƒ…å†µ
                    return;
                }

                document.querySelectorAll('.character').forEach(char => {
                    char.addEventListener('click', () => {
                        try {
                            this.utterance.text = char.dataset.char; // è®¾ç½®æœ—è¯»æ–‡æœ¬
                            this.synth.speak(this.utterance); // è§¦å‘è¯­éŸ³
                            prompt.style.display = 'none'; // éšè—æç¤º
                        } catch (e) {
                            prompt.textContent = 'è¯­éŸ³åŠŸèƒ½æš‚ä¸å¯ç”¨'; // æ˜¾ç¤ºé”™è¯¯æç¤º
                        }
                    });
                });
            }

            checkCompletion() {
                // æ£€æŸ¥æ¸¸æˆæ˜¯å¦å®Œæˆ
                const completed = [...document.querySelectorAll('.drop-zone')]
                    .filter(zone => zone.textContent).length === 6; // æ£€æŸ¥æ‰€æœ‰æ”¾ç½®åŒºæ˜¯å¦å¡«æ»¡
                if (completed) document.getElementById('restart').style.display = 'block'; // æ˜¾ç¤ºé‡å¯æŒ‰é’®
            }
        }

        let game = new Game(); // åˆ›å»ºæ¸¸æˆå®ä¾‹
        document.getElementById('restart').addEventListener('click', () => {
            game = new Game(); // é‡å¯æ¸¸æˆ
            document.getElementById('restart').style.display = 'none'; // éšè—é‡å¯æŒ‰é’®
            document.getElementById('speech-prompt').style.display = 'block'; // æ˜¾ç¤ºè¯­éŸ³æç¤º
        });
    </script>
</body>
</html>
