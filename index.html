<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ê±âÂ≠óÂ≠¶‰π†Ê∏∏Êàè</title>
    <style>
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(to bottom, #ffcccc, #ffffff);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto;
        }
        .container {
            width: 80%;
            max-width: 800px;
            text-align: center;
            position: relative;
        }
        .row {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }
        .pinyin {
            margin: 10px;
            font-size: 24px;
            color: #333;
            background: #fff;
            padding: 5px 10px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .box {
            width: 60px;
            height: 60px;
            border: 3px dashed #ff9999;
            border-radius: 15px;
            background: #fff;
            margin: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .box.filled {
            border: none;
            background: #90ee90;
            color: #fff;
            box-shadow: 0 0 10px #66cc66;
        }
        .character {
            width: 60px;
            height: 60px;
            background: #ffeb99;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            margin: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            cursor: move;
            transition: transform 0.2s ease;
        }
        .character:hover {
            transform: scale(1.1);
            background: #ffe066;
        }
        .error {
            border: 3px solid #ff6666;
            animation: shake 0.5s;
        }
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }
        #restart {
            display: none;
            padding: 15px 30px;
            font-size: 20px;
            background: #ff6666;
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            margin-top: 20px;
            transition: background 0.3s ease;
        }
        #restart:hover {
            background: #ff3333;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #ddd;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        .progress {
            height: 100%;
            background: #66ccff;
            width: 0%;
            transition: width 0.5s ease;
        }
        .star {
            position: absolute;
            font-size: 30px;
            color: #ffcc00;
            animation: starAnimation 1s ease-out forwards;
        }
        @keyframes starAnimation {
            0% { transform: scale(0) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.5) rotate(180deg); opacity: 1; }
            100% { transform: scale(0) rotate(360deg); opacity: 0; }
        }
        .mascot {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 80px;
            height: 80px;
            background: url('https://via.placeholder.com/80?text=üêº') no-repeat center;
            background-size: contain;
        }
        .message {
            position: absolute;
            top: 90px;
            left: 10px;
            background: #fff;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            font-size: 16px;
            color: #333;
            display: none;
        }
        @media (max-width: 600px) {
            .pinyin, .box, .character {
                width: 40px;
                height: 40px;
                font-size: 18px;
                margin: 5px;
            }
            #restart {
                padding: 10px 20px;
                font-size: 16px;
            }
            .mascot {
                width: 60px;
                height: 60px;
            }
            .message {
                font-size: 14px;
                top: 70px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="mascot"></div>
        <div class="message" id="mascotMessage"></div>
        <div class="progress-bar"><div class="progress" id="progress"></div></div>
        <div class="row" id="pinyinRow"></div>
        <div class="row" id="boxRow"></div>
        <div class="row" id="characterRow"></div>
        <button id="restart">ÈáçÊñ∞ÂºÄÂßã</button>
    </div>

    <script>
        const pronunciationMap = {
            "‰∏Ä": "yƒ´", "‰∫å": "√®r", "‰∏â": "sƒÅn", "Âõõ": "s√¨", "‰∫î": "w«î",
            "ÂÖ≠": "li√π", "‰∏É": "qƒ´", "ÂÖ´": "bƒÅ", "‰πù": "ji«î", "ÂçÅ": "sh√≠",
            "‰∏§": "li«éng", "Âè™": "zhƒ´", "Â§¥": "t√≥u", "Âèà": "y√≤u", "‰∫Ü": "le",
            "‰∏ç": "b√π", "Â§ß": "d√†", "Â∞è": "xi«éo", "‰∏ä": "sh√†ng", "‰∏ã": "xi√†",
            "Â§ö": "du≈ç", "Â∞ë": "sh«éo", "ÁôΩ": "b√°i", "Â§©": "tiƒÅn", "‰∫ë": "y√∫n",
            "Â±±": "shƒÅn", "Êúà": "yu√®", "‰∫Æ": "li√†ng", "Êòü": "xƒ´ng", "È©¨": "m«é",
            "Áâõ": "ni√∫", "Áæä": "y√°ng", "ÂÖî": "t√π", "Ëô´": "ch√≥ng", "È∏ü": "ni«éo",
            "Ëä±": "huƒÅ", "Ëçâ": "c«éo", "Ê†ë": "sh√π", "Áúã": "k√†n", "Ëµ∞": "z«íu",
            "Á¨ë": "xi√†o", "Êù•": "l√°i", "È£û": "fƒìi", "Áà±": "√†i", "ÊòØ": "sh√¨",
            "Ë∑ë": "p«éo", "Ë∑≥": "ti√†o", "È´ò": "gƒÅo", "Â§™": "t√†i", "Èò≥": "y√°ng",
            "Âú∞": "d√¨", "ÂêÉ": "chƒ´", "ÂÖ¥": "x√¨ng", "Âø´": "ku√†i", "Â•Ω": "h«éo",
            "ÁöÑ": "de", "Áà∏": "b√†", "Â¶à": "mƒÅ", "Êàë": "w«í", "‰∫∫": "r√©n",
            "ÂÑø": "√©r", "Â≠ê": "z«ê", "Âè£": "k«íu", "Âá†": "j«ê", "‰∏™": "g√®",
            "‰∏≠": "zh≈çng", "Áâô": "y√°", "Èó®": "m√©n", "Êâã": "sh«íu", "ÂøÉ": "xƒ´n",
            "‰ªÄ": "sh√©n", "‰πà": "me", "ÂºÄ": "kƒÅi", "ÂèØ": "kƒõ", "Âõû": "hu√≠",
            "Âá∫": "ch≈´", "Âéª": "q√π", "Èáå": "l«ê", "Â∫ä": "chu√°ng", "ËΩ¶": "chƒì",
            "ÂÆ∂": "jiƒÅ", "Áà∑": "y√©", "Â•∂": "n«éi", "‰Ω†": "n«ê", "Ê∞¥": "shu«ê",
            "È•≠": "f√†n", "Êúâ": "y«íu", "Êâæ": "zh«éo", "Âùê": "zu√≤", "Âê¨": "tƒ´ng",
            "Áé©": "w√°n", "Âì≠": "k≈´", "Ëµ∑": "q«ê", "Âñù": "hƒì", "Âà∞": "d√†o",
            "Ê≤≥": "h√©", "Êµ∑": "h«éi", "È£é": "fƒìng", "Èõ®": "y«î", "Èõ™": "xuƒõ",
            "Êò•": "ch≈´n", "Â§è": "xi√†", "Áßã": "qi≈´", "ÂÜ¨": "d≈çng", "È±º": "y√∫",
            "Áãº": "l√°ng", "Áå´": "mƒÅo", "Áãó": "g«íu", "Ëù∂": "di√©", "ËúÇ": "fƒìng",
            "Ë∞¢": "xi√®", "Áù°": "shu√¨", "Á∫¢": "h√≥ng", "Ëìù": "l√°n", "Áªø": "l«ú",
            "Áæé": "mƒõi", "‰∏Ω": "l√¨", "Êú®": "m√π", "Áéã": "w√°ng", "Êó•": "r√¨",
            "Áôæ": "b«éi", "ÂÖ¨": "g≈çng", "‰∏ª": "zh«î", "Áîü": "shƒìng", "Èïø": "zh«éng",
            "ËßÅ": "ji√†n", "Â•≥": "n«ö", "Âú®": "z√†i", "Êó©": "z«éo", "Âè∂": "y√®",
            "Ê£Æ": "sƒìn", "Êûó": "l√≠n", "‰π¶": "sh≈´", "‰π†": "x√≠", "ÂØπ": "du√¨",
            "Ê≤°": "m√©i", "ËÄÅ": "l«éo", "Â∏à": "shƒ´", "‰ªñ": "tƒÅ", "‰ª¨": "men",
            "Ââç": "qi√°n", "Âêé": "h√≤u", "Âì•": "gƒì", "Âßê": "jiƒõ", "Âºü": "d√¨",
            "Â¶π": "m√®i", "ÂõΩ": "gu√≥", "Ë°£": "yƒ´", "Êúç": "f√∫", "Âπº": "y√≤u",
            "Âõ≠": "yu√°n", "Ê†°": "xi√†o", "Áà¨": "p√°", "Ëóè": "c√°ng", "ËØ¥": "shu≈ç",
            "Ëßâ": "ju√©", "Êâì": "d«é", "ÂÜô": "xiƒõ", "ÂÅö": "zu√≤", "Á©ø": "chuƒÅn",
            "Ë¶Å": "y√†o", "ÊÉ≥": "xi«éng", "ÈªÑ": "hu√°ng", "Èªë": "hƒìi", "Âæà": "hƒõn",
            "ÂÜç": "z√†i", "Êää": "b«é", "Âíå": "h√©", "Âïä": "ƒÅ", "Âêß": "ba",
            "Âêó": "mƒÅ", "Âæó": "de", "ÁùÄ": "zhe", "ÂçÉ": "qiƒÅn", "‰∏á": "w√†n",
            "Áîª": "hu√†", "Â≠¶": "xu√©", "‰πê": "l√®", "Âúü": "t«î", "ÁÅ´": "hu«í",
            "ÂÖâ": "guƒÅng", "Âäõ": "l√¨", "Ê∞î": "q√¨", "Âçà": "w«î", "Âèë": "fƒÅ",
            "Áîµ": "di√†n", "ÂÆù": "b«éo", "Ë¥ù": "b√®i", "Ëá™": "z√¨", "Â∑±": "j«ê",
            "Ë∫´": "shƒìn", "‰ªä": "jƒ´n", "Âπ¥": "ni√°n", "Â≤Å": "su√¨", "Á±≥": "m«ê",
            "Èù¢": "mi√†n", "ÂåÖ": "bƒÅo", "Áìú": "guƒÅ", "Êûú": "gu«í", "ÁÇπ": "di«én",
            "Â≠ó": "z√¨", "ËØù": "hu√†", "Êú∫": "jƒ´", "Ëàπ": "chu√°n", "Ëèú": "c√†i",
            "Â≠©": "h√°i", "‰∏∫": "w√®i", "ÊØî": "b«ê", "‰ºö": "hu√¨", "Á´ô": "zh√†n",
            "Ë°å": "x√≠ng", "Âè´": "ji√†o", "Ëøá": "gu√≤", "ÂÖ≥": "guƒÅn", "Âñú": "x«ê",
            "Ê¨¢": "huƒÅn", "ÊÄï": "p√†", "Áªô": "gƒõi", "Ë∑ü": "gƒìn", "Ëøõ": "j√¨n",
            "Âπ≤": "g√†n", "Âùè": "hu√†i", "Èùí": "qƒ´ng", "Êòé": "m√≠ng", "Êôö": "w«én",
            "Áúü": "zhƒìn", "È•±": "b«éo", "Èîô": "cu√≤", "‰∏ú": "d≈çng", "Ë•ø": "xƒ´",
            "Â§ñ": "w√†i", "ÊØè": "mƒõi", "Ëøô": "zh√®", "Â•π": "tƒÅ", "‰πü": "yƒõ",
            "Ëøò": "h√°i", "‰ª•": "y«ê", "Âë¢": "ne", "Â∑•": "g≈çng", "Êñπ": "fƒÅng",
            "Êú¨": "bƒõn", "Êñá": "w√©n", "Áü≥": "sh√≠", "Èáë": "jƒ´n", "Êúã": "p√©ng",
            "Âèã": "y«íu", "Âèî": "sh≈´", "Â®É": "w√°", "Â©Ü": "p√≥", "Âåª": "yƒ´",
            "ËÄ≥": "ƒõr", "Áúº": "y«én", "Êô¥": "q√≠ng", "Ëõô": "wƒÅ", "È∏°": "jƒ´",
            "È∏≠": "yƒÅ", "Ëãπ": "p√≠ng", "Ê°É": "t√°o", "ÁêÉ": "qi√∫", "Á¨î": "b«ê",
            "ÁÅØ": "dƒìng", "ËØ≠": "y«î", "ËØæ": "k√®", "Ê≠å": "gƒì", "Â£∞": "shƒìng",
            "Èü≥": "yƒ´n", "Ëæπ": "biƒÅn", "Êó∂": "sh√≠", "‰Ωì": "t«ê", "Ê†∑": "y√†ng",
            "ÂàÜ": "fƒìn", "ÈóÆ": "w√®n", "Âèò": "bi√†n", "Êàê": "ch√©ng", "Áî®": "y√≤ng",
            "Âä†": "jiƒÅ", "‰π∞": "m«éi", "ÂΩì": "dƒÅng", "Âä®": "d√≤ng", "‰Ωú": "zu√≤",
            "‰Ωè": "zh√π", "Êîæ": "f√†ng", "ËØª": "d√∫", "ËΩ¨": "zhu«én", "Âî±": "ch√†ng",
            "ÂÅú": "t√≠ng", "Ê∏∏": "y√≥u", "Êï∞": "sh«î", "ÂÉè": "xi√†ng", "Âèç": "f«én",
            "Ê≠£": "zh√®ng", "Âêå": "t√≥ng", "Á©∫": "k≈çng", "Êñ∞": "xƒ´n", "Áâá": "pi√†n",
            "Âçä": "b√†n", "Êúµ": "du«í", "Êù°": "ti√°o", "Âåó": "bƒõi", "Âçó": "n√°n",
            "ÈÇ£": "n√†", "Ë∞Å": "sh√©i", "Êâç": "c√°i", "Êõ¥": "g√®ng", "ÈÉΩ": "d≈çu",
            "‰ªé": "c√≥ng", "Âêë": "xi√†ng", "Â∞±": "ji√π"
        };

        let weights = JSON.parse(localStorage.getItem('weights')) || {};
        Object.keys(pronunciationMap).forEach(char => {
            if (!weights[char]) weights[char] = 1;
        });

        const pinyinRow = document.getElementById('pinyinRow');
        const boxRow = document.getElementById('boxRow');
        const characterRow = document.getElementById('characterRow');
        const restartBtn = document.getElementById('restart');
        const progressBar = document.getElementById('progress');
        const mascotMessage = document.getElementById('mascotMessage');
        let selectedPairs = [];

        function initGame() {
            pinyinRow.innerHTML = '';
            boxRow.innerHTML = '';
            characterRow.innerHTML = '';
            restartBtn.style.display = 'none';
            progressBar.style.width = '0%';
            showMessage("ÂºÄÂßãÂåπÈÖçÂêßÔºÅ");

            selectedPairs = selectRandomPairs(5);
            selectedPairs.forEach(pair => {
                const pinyinDiv = document.createElement('div');
                pinyinDiv.className = 'pinyin';
                pinyinDiv.textContent = pair.pinyin;
                pinyinRow.appendChild(pinyinDiv);

                const boxDiv = document.createElement('div');
                boxDiv.className = 'box';
                boxDiv.dataset.pinyin = pair.pinyin;
                boxDiv.addEventListener('dragover', dragOver);
                boxDiv.addEventListener('drop', drop);
                boxRow.appendChild(boxDiv);
            });

            const shuffledChars = shuffle(selectedPairs.map(pair => pair.char));
            shuffledChars.forEach(char => {
                const charDiv = document.createElement('div');
                charDiv.className = 'character';
                charDiv.textContent = char;
                charDiv.draggable = true;
                charDiv.addEventListener('dragstart', dragStart);
                charDiv.addEventListener('click', () => speak(char));
                characterRow.appendChild(charDiv);
            });
        }

        function selectRandomPairs(num) {
            const chars = Object.keys(pronunciationMap);
            const totalWeight = Object.values(weights).reduce((a, b) => a + b, 0);
            const pairs = [];
            while (pairs.length < num) {
                const rand = Math.random() * totalWeight;
                let sum = 0;
                for (let char of chars) {
                    sum += weights[char];
                    if (sum >= rand && !pairs.some(p => p.char === char)) {
                        pairs.push({ char, pinyin: pronunciationMap[char] });
                        break;
                    }
                }
            }
            return pairs;
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function dragStart(e) {
            e.dataTransfer.setData('text', e.target.textContent);
        }

        function dragOver(e) {
            if (!e.target.classList.contains('filled')) {
                e.preventDefault();
            }
        }

        function drop(e) {
            e.preventDefault();
            const char = e.dataTransfer.getData('text');
            const pinyin = e.target.dataset.pinyin;
            if (pronunciationMap[char] === pinyin) {
                e.target.textContent = char;
                e.target.classList.add('filled');
                weights[char] = Math.max(0.05, weights[char] * 0.8);
                characterRow.removeChild([...characterRow.children].find(c => c.textContent === char));
                addStar(e.target);
                playSound('correct');
                showMessage("Â§™Ê£í‰∫ÜÔºÅ");
                updateProgress();
                checkGameComplete();
            } else {
                e.target.classList.add('error');
                weights[char] = Math.min(0.9, weights[char] * 1.2);
                playSound('error');
                showMessage("ÂÜçËØï‰∏ÄÊ¨°ÂêßÔºÅ");
                setTimeout(() => e.target.classList.remove('error'), 500);
            }
            localStorage.setItem('weights', JSON.stringify(weights));
        }

        function updateProgress() {
            const filledCount = boxRow.querySelectorAll('.filled').length;
            const total = selectedPairs.length;
            progressBar.style.width = `${(filledCount / total) * 100}%`;
        }

        function addStar(target) {
            const star = document.createElement('div');
            star.className = 'star';
            star.textContent = '‚òÖ';
            star.style.left = `${target.offsetLeft + target.offsetWidth / 2 - 15}px`;
            star.style.top = `${target.offsetTop - 30}px`;
            document.querySelector('.container').appendChild(star);
            setTimeout(() => star.remove(), 1000);
        }

        function playSound(type) {
            const audio = new Audio();
            audio.src = type === 'correct' 
                ? 'https://www.soundjay.com/buttons/sounds/beep-01a.mp3' // Replace with a cheerful sound URL
                : 'https://www.soundjay.com/buttons/sounds/beep-02.mp3'; // Replace with a gentle error sound URL
            audio.play().catch(() => console.log('Audio play failed'));
        }

        function showMessage(text) {
            mascotMessage.textContent = text;
            mascotMessage.style.display = 'block';
            setTimeout(() => mascotMessage.style.display = 'none', 2000);
        }

        function checkGameComplete() {
            if (boxRow.querySelectorAll('.filled').length === selectedPairs.length) {
                restartBtn.style.display = 'block';
                showMessage("‰Ω†ÁúüÂéâÂÆ≥ÔºÅ");
            }
        }

        function speak(char) {
            const utterance = new SpeechSynthesisUtterance(pronunciationMap[char]);
            utterance.lang = 'zh-CN';
            utterance.rate = 0.8;
            utterance.volume = 1.0;
            const voices = window.speechSynthesis.getVoices();
            const mandarinVoice = voices.find(voice => voice.lang === 'zh-CN' && voice.name.includes('Mandarin'));
            if (mandarinVoice) {
                utterance.voice = mandarinVoice;
            }
            window.speechSynthesis.speak(utterance);
        }

        window.addEventListener('load', () => {
            window.speechSynthesis.getVoices();
            initGame();
        });

        window.speechSynthesis.onvoiceschanged = () => {
            window.speechSynthesis.getVoices();
        };

        restartBtn.addEventListener('click', initGame);
    </script>
</body>
</html>
