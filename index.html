<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ±‰å­—æ‹¼è¯»æŒ‘æˆ˜èµ›å®Œæ•´ç‰ˆ</title>
    <style>
        :root {
            --primary-color: #FFB6C1;
            --secondary-color: #87CEEB;
        }

        body {
            font-family: 'Comic Sans MS', 'å¹¼åœ†', 'YouYuan', cursive;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
       .game-title {
            color: #ff4757;
            font-size: 2.5em;
            text-shadow: 2px 2px #fff;
            margin: 20px 0;
        }

        .game-container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            max-width: 800px;
            width: 100%;
        }

        .game-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            justify-items: center;
            margin: 20px 0;
        }

        .pinyin {
            color: #4CAF50;
            font-size: 24px;
            text-align: center;
            width: 100px;
            margin: 0 5px;
        }

        .drop-zone {
            width: 70px;
            height: 70px;
            border: 2px solid #666;
            border-radius: 10px;
            background: white;
            margin: 0 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 42px;
            font-family: 'åæ–‡å½©äº‘', cursive;
        }

        .character {
            width: 70px;
            height: 70px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            cursor: grab;
            user-select: none;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 42px;
            font-family: 'åæ–‡å½©äº‘', cursive;
            transition: all 0.3s;
        }

        .character:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .character[hidden] {
            display: none !important;
        }

        .correct { 
            background: #90EE90 !important;
            transform: scale(1.05);
        }
        .wrong { 
            background: #FFB6C1 !important;
            animation: shake 0.5s;
        }

        #restart {
            padding: 12px 24px;
            font-size: 20px;
            border-radius: 30px;
            background: #FFD700;
            border: none;
            cursor: pointer;
            display: none;
            font-family: 'å¹¼åœ†', 'YouYuan', cursive;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        @media (max-width: 600px) {
            .game-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }
            .pinyin { font-size: 18px; }
            .drop-zone, .character {
                width: 50px;
                height: 50px;
            }
        }
    </style>
</head>
<body>
    <h1 class="game-title">ğŸ¼ æ™ºèƒ½æ±‰å­—æ‹¼è¯»æŒ‘æˆ˜ ğŸª</h1>
    <div class="game-container">
        <div class="game-grid" id="pinyin-row"></div>
        <div class="game-grid" id="dropzone-row"></div>
        <div class="game-grid" id="character-row"></div>
    </div>
    <button id="restart">å†æ¥ä¸€æ¬¡ï¼</button>

    <script>
        const pronunciationMap = {
            "ä¸€":"yÄ«", "äºŒ":"Ã¨r", "ä¸‰":"sÄn", "å››":"sÃ¬", "äº”":"wÇ”",
            "å…­":"liÃ¹", "ä¸ƒ":"qÄ«", "å…«":"bÄ", "ä¹":"jiÇ”", "å":"shÃ­",
            "ä¸¤":"liÇng", "åª":"zhÄ«", "å¤´":"tÃ³u", "åˆ":"yÃ²u", "äº†":"le",
            "ä¸":"bÃ¹", "å¤§":"dÃ ", "å°":"xiÇo", "ä¸Š":"shÃ ng", "ä¸‹":"xiÃ ",
            "å¤š":"duÅ", "å°‘":"shÇo", "ç™½":"bÃ¡i", "å¤©":"tiÄn", "äº‘":"yÃºn",
            "å±±":"shÄn", "æœˆ":"yuÃ¨", "äº®":"liÃ ng", "æ˜Ÿ":"xÄ«ng", "é©¬":"mÇ",
            "ç‰›":"niÃº", "ç¾Š":"yÃ¡ng", "å…”":"tÃ¹", "è™«":"chÃ³ng", "é¸Ÿ":"niÇo",
            "èŠ±":"huÄ", "è‰":"cÇo", "æ ‘":"shÃ¹", "çœ‹":"kÃ n", "èµ°":"zÇ’u",
            "ç¬‘":"xiÃ o", "æ¥":"lÃ¡i", "é£":"fÄ“i", "çˆ±":"Ã i", "æ˜¯":"shÃ¬",
            "è·‘":"pÇo", "è·³":"tiÃ o", "é«˜":"gÄo", "ä¸€":"yÄ«", "å¤ª":"tÃ i",
            "é˜³":"yÃ¡ng", "åœ°":"dÃ¬", "åƒ":"chÄ«", "å…´":"xÃ¬ng", "å¿«":"kuÃ i",
            "å¥½":"hÇo", "çš„":"de", "çˆ¸":"bÃ ", "å¦ˆ":"mÄ", "æˆ‘":"wÇ’",
            "äºº":"rÃ©n", "å„¿":"Ã©r", "å­":"zÇ", "å£":"kÇ’u", "å‡ ":"jÇ",
            "ä¸ª":"gÃ¨", "ä¸­":"zhÅng", "ç‰™":"yÃ¡", "é—¨":"mÃ©n", "æ‰‹":"shÇ’u",
            "å¿ƒ":"xÄ«n", "ä»€":"shÃ©n", "ä¹ˆ":"me", "å¼€":"kÄi", "å¯":"kÄ›",
            "å›":"huÃ­", "å‡º":"chÅ«", "å»":"qÃ¹", "é‡Œ":"lÇ", "åºŠ":"chuÃ¡ng",
            "è½¦":"chÄ“", "å®¶":"jiÄ", "çˆ·":"yÃ©", "å¥¶":"nÇi", "ä½ ":"nÇ",
            "æ°´":"shuÇ", "é¥­":"fÃ n", "æœ‰":"yÇ’u", "æ‰¾":"zhÇo", "å":"zuÃ²",
            "å¬":"tÄ«ng", "ç©":"wÃ¡n", "å“­":"kÅ«", "èµ·":"qÇ", "å–":"hÄ“",
            "åˆ°":"dÃ o", "æ²³":"hÃ©", "æµ·":"hÇi", "é£":"fÄ“ng", "é›¨":"yÇ”",
            "é›ª":"xuÄ›", "æ˜¥":"chÅ«n", "å¤":"xiÃ ", "ç§‹":"qiÅ«", "å†¬":"dÅng",
            "é±¼":"yÃº", "ç‹¼":"lÃ¡ng", "çŒ«":"mÄo", "ç‹—":"gÇ’u", "è¶":"diÃ©",
            "èœ‚":"fÄ“ng", "è°¢":"xiÃ¨", "ç¡":"shuÃ¬", "çº¢":"hÃ³ng", "è“":"lÃ¡n",
            "ç»¿":"lÇœ", "ç¾":"mÄ›i", "ä¸½":"lÃ¬", "æœ¨":"mÃ¹", "ç‹":"wÃ¡ng",
            "æ—¥":"rÃ¬", "ç™¾":"bÇi", "å…¬":"gÅng", "ä¸»":"zhÇ”", "ç”Ÿ":"shÄ“ng",
            "é•¿":"zhÇng", "è§":"jiÃ n", "å¥³":"nÇš", "åœ¨":"zÃ i", "æ—©":"zÇo",
            "å¶":"yÃ¨", "æ£®":"sÄ“n", "æ—":"lÃ­n", "ä¹¦":"shÅ«", "ä¹ ":"xÃ­",
            "å¯¹":"duÃ¬", "æ²¡":"mÃ©i", "è€":"lÇo", "å¸ˆ":"shÄ«", "ä»–":"tÄ",
            "ä»¬":"men", "å‰":"qiÃ¡n", "å":"hÃ²u", "å“¥":"gÄ“", "å§":"jiÄ›",
            "å¼Ÿ":"dÃ¬", "å¦¹":"mÃ¨i", "å›½":"guÃ³", "è¡£":"yÄ«", "æœ":"fÃº",
            "å¹¼":"yÃ²u", "å›­":"yuÃ¡n", "æ ¡":"xiÃ o", "çˆ¬":"pÃ¡", "è—":"cÃ¡ng",
            "è¯´":"shuÅ", "è§‰":"juÃ©", "æ‰“":"dÇ", "å†™":"xiÄ›", "åš":"zuÃ²",
            "ç©¿":"chuÄn", "è¦":"yÃ o", "æƒ³":"xiÇng", "é»„":"huÃ¡ng", "é»‘":"hÄ“i",
            "å¾ˆ":"hÄ›n", "å†":"zÃ i", "æŠŠ":"bÇ", "å’Œ":"hÃ©", "å•Š":"Ä",
            "å§":"ba", "å—":"mÄ", "å¾—":"de", "ç€":"zhe", "åƒ":"qiÄn",
            "ä¸‡":"wÃ n", "ç”»":"huÃ ", "å­¦":"xuÃ©", "ä¹":"lÃ¨", "åœŸ":"tÇ”",
            "ç«":"huÇ’", "å…‰":"guÄng", "åŠ›":"lÃ¬", "æ°”":"qÃ¬", "åˆ":"wÇ”",
            "å‘":"fÄ", "ç”µ":"diÃ n", "å®":"bÇo", "è´":"bÃ¨i", "è‡ª":"zÃ¬",
            "å·±":"jÇ", "èº«":"shÄ“n", "ä»Š":"jÄ«n", "å¹´":"niÃ¡n", "å²":"suÃ¬",
            "ç±³":"mÇ", "é¢":"miÃ n", "åŒ…":"bÄo", "ç“œ":"guÄ", "æœ":"guÇ’",
            "ç‚¹":"diÇn", "å­—":"zÃ¬", "è¯":"huÃ ", "æœº":"jÄ«", "èˆ¹":"chuÃ¡n",
            "èœ":"cÃ i", "å­©":"hÃ¡i", "ä¸º":"wÃ¨i", "æ¯”":"bÇ", "ä¼š":"huÃ¬",
            "ç«™":"zhÃ n", "è¡Œ":"xÃ­ng", "å«":"jiÃ o", "è¿‡":"guÃ²", "å…³":"guÄn",
            "å–œ":"xÇ", "æ¬¢":"huÄn", "æ€•":"pÃ ", "ç»™":"gÄ›i", "è·Ÿ":"gÄ“n",
            "è¿›":"jÃ¬n", "å¹²":"gÃ n", "å":"huÃ i", "é’":"qÄ«ng", "æ˜":"mÃ­ng",
            "æ™š":"wÇn", "çœŸ":"zhÄ“n", "é¥±":"bÇo", "é”™":"cuÃ²", "ä¸œ":"dÅng",
            "è¥¿":"xÄ«", "å¤–":"wÃ i", "æ¯":"mÄ›i", "è¿™":"zhÃ¨", "å¥¹":"tÄ",
            "ä¹Ÿ":"yÄ›", "è¿˜":"hÃ¡i", "ä»¥":"yÇ", "å‘¢":"ne", "å·¥":"gÅng",
            "æ–¹":"fÄng", "æœ¬":"bÄ›n", "æ–‡":"wÃ©n", "çŸ³":"shÃ­", "é‡‘":"jÄ«n",
            "æœ‹":"pÃ©ng", "å‹":"yÇ’u", "å”":"shÅ«", "å¨ƒ":"wÃ¡", "å©†":"pÃ³",
            "åŒ»":"yÄ«", "è€³":"Ä›r", "çœ¼":"yÇn", "æ™´":"qÃ­ng", "è›™":"wÄ",
            "é¸¡":"jÄ«", "é¸­":"yÄ", "è‹¹":"pÃ­ng", "æ¡ƒ":"tÃ¡o", "çƒ":"qiÃº",
            "ç¬”":"bÇ", "ç¯":"dÄ“ng", "è¯­":"yÇ”", "è¯¾":"kÃ¨", "æ­Œ":"gÄ“",
            "å£°":"shÄ“ng", "éŸ³":"yÄ«n", "è¾¹":"biÄn", "æ—¶":"shÃ­", "ä½“":"tÇ",
            "æ ·":"yÃ ng", "åˆ†":"fÄ“n", "é—®":"wÃ¨n", "å˜":"biÃ n", "æˆ":"chÃ©ng",
            "ç”¨":"yÃ²ng", "åŠ ":"jiÄ", "ä¹°":"mÇi", "å½“":"dÄng", "åŠ¨":"dÃ²ng",
            "ä½œ":"zuÃ²", "ä½":"zhÃ¹", "æ”¾":"fÃ ng", "è¯»":"dÃº", "è½¬":"zhuÇn",
            "å”±":"chÃ ng", "åœ":"tÃ­ng", "æ¸¸":"yÃ³u", "æ•°":"shÇ”", "åƒ":"xiÃ ng",
            "å":"fÇn", "æ­£":"zhÃ¨ng", "åŒ":"tÃ³ng", "ç©º":"kÅng", "æ–°":"xÄ«n",
            "ç‰‡":"piÃ n", "åŠ":"bÃ n", "æœµ":"duÇ’", "æ¡":"tiÃ¡o", "åŒ—":"bÄ›i",
            "å—":"nÃ¡n", "é‚£":"nÃ ", "è°":"shÃ©i", "æ‰":"cÃ¡i", "æ›´":"gÃ¨ng",
            "éƒ½":"dÅu", "ä»":"cÃ³ng", "å‘":"xiÃ ng", "å°±":"jiÃ¹"
        };

        class Game {
            constructor() {
                this.weights = JSON.parse(localStorage.getItem('characterWeights')) || {};
                this.initWeights();
                this.synth = window.speechSynthesis;
                this.utterance = new SpeechSynthesisUtterance();
                this.utterance.lang = 'zh-CN';
                this.utterance.rate = 0.8;
                this.initGame();
            }

            initWeights() {
                for (const char in pronunciationMap) {
                    if (!this.weights[char]) this.weights[char] = 1;
                }
            }

            getRandomCharacters() {
                const chars = Object.keys(pronunciationMap);
                const weightedChars = chars.map(char => ({
                    char,
                    weight: this.weights[char]
                }));
                
                const totalWeight = weightedChars.reduce((sum, c) => sum + c.weight, 0);
                const selected = [];
                
                while (selected.length < 6) {
                    const rand = Math.random() * totalWeight;
                    let current = 0;
                    for (const {char, weight} of weightedChars) {
                        current += weight;
                        if (rand <= current && !selected.includes(char)) {
                            selected.push(char);
                            break;
                        }
                    }
                }
                return selected;
            }

            initGame() {
                const characters = this.getRandomCharacters();
                const pinyinPairs = characters.map(c => [pronunciationMap[c], c]);
                
                this.renderGame(pinyinPairs);
                this.setupDragDrop();
                this.setupSpeech();
            }

            renderGame(pairs) {
                const pinyinRow = document.getElementById('pinyin-row');
                const dropRow = document.getElementById('dropzone-row');
                const charRow = document.getElementById('character-row');
                
                pinyinRow.innerHTML = dropRow.innerHTML = charRow.innerHTML = '';

                pairs.forEach(([pinyin]) => {
                    pinyinRow.innerHTML += `<div class="pinyin">${pinyin}</div>`;
                    const dropZone = document.createElement('div');
                    dropZone.className = 'drop-zone';
                    dropZone.dataset.pinyin = pinyin;
                    dropRow.appendChild(dropZone);
                });

                pairs
                    .sort(() => Math.random() - 0.5)
                    .forEach(([_, char]) => {
                        const charDiv = document.createElement('div');
                        charDiv.className = 'character';
                        charDiv.draggable = true;
                        charDiv.dataset.char = char;
                        charDiv.textContent = char;
                        charRow.appendChild(charDiv);
                    });
            }

            setupDragDrop() {
                const chars = document.querySelectorAll('.character');
                const dropZones = document.querySelectorAll('.drop-zone');

                chars.forEach(char => {
                    char.addEventListener('dragstart', e => {
                        e.dataTransfer.setData('text/plain', char.dataset.char);
                    });
                });

                dropZones.forEach(zone => {
                    zone.addEventListener('dragover', e => e.preventDefault());
                    zone.addEventListener('drop', e => {
                        e.preventDefault();
                        const char = e.dataTransfer.getData('text/plain');
                        const correctPinyin = pronunciationMap[char];
                        
                        if (zone.dataset.pinyin === correctPinyin) {
                            // æ–°å¢å­—ä½“å¤§å°é€‚é…
                            zone.innerHTML = `<div style="font-size:inherit">${char}</div>`;
                            document.querySelectorAll(`.character[data-char="${char}"]`)
                                .forEach(c => c.hidden = true);
                            
                            zone.classList.add('correct');
                            this.updateWeights(char, true);
                        } else {
                            zone.classList.add('wrong');
                            setTimeout(() => zone.classList.remove('wrong'), 500);
                            this.updateWeights(char, false);
                        }
                        this.checkCompletion();
                    });
                });
            }

            updateWeights(char, isCorrect) {
                this.weights[char] = Math.min(Math.max(
                    isCorrect ? this.weights[char] * 0.8 : this.weights[char] * 1.2,
                    0.05
                ), 0.9);
                localStorage.setItem('characterWeights', JSON.stringify(this.weights));
            }

            setupSpeech() {
                document.querySelectorAll('.character').forEach(char => {
                    char.addEventListener('click', () => {
                        this.utterance.text = char.dataset.char;
                        this.synth.speak(this.utterance);
                    });
                });
            }

            checkCompletion() {
                const completed = [...document.querySelectorAll('.drop-zone')]
                    .filter(zone => zone.textContent).length === 6;
                if (completed) document.getElementById('restart').style.display = 'block';
            }
        }

        let game = new Game();
        document.getElementById('restart').addEventListener('click', () => {
            game = new Game();
            document.getElementById('restart').style.display = 'none';
        });
    </script>
</body>
</html>
